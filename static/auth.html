<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Static Authorization</title>
        <meta name="viewport" content="width=device-width,initial-scale=1" />
    </head>
    <body>
        <script>
            const API_URL = "https://backend.compoundfolio.com:4330"
            const AUTH_ENDPOINT = "https://accounts.google.com/o/oauth2/v2/auth"
            const CLIENT_ID = "931638889409-poa2ul8vgh9iqmu4d3da2k9a1lfsucsp.apps.googleusercontent.com"
            const REDIRECT_URI = "https://backend.compoundfolio.com:4330/static/callback.html"
            
            const login_with_google = () => {
                fetch(API_URL + "/auth/state")
                    .then(response => {
                        if (response.status == "200") {
                            return response.json()
                        } else {
                            alert("Could not get state token from server, check console for details")
                            console.error(response)
                        }
                    })
                    .then(body => {
                        const auth_src = `${AUTH_ENDPOINT}?client_id=${CLIENT_ID}` +
                            `&response_type=code&scope=${encodeURIComponent("openid email")}` +
                            `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}` +
                            `&state=${body.state}`
                        window.location.href = auth_src
                    })
                    .catch(e => {
                        alert("Could not make a request to backend to get the state token. Check console for details")
                        console.error(e)
                    })
            }
        </script>
        <button id="sign-in-google" onclick="login_with_google()">Sign In with Google</button>
    </body>
</html>
